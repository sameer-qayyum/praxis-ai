# Public Form Submission API

This API allows publicly shared V0-generated apps to submit form data to users' Google Sheets without exposing OAuth credentials or requiring API keys.

## URL Structure

```
POST /api/public/forms/{appId}/{pathSecret}/submit
```

- `appId`: UUID of the app
- `pathSecret`: Auto-generated secure path segment (32 characters) that acts as authentication

## Authentication

Authentication is URL-based. Each app has a unique `appId` and `pathSecret` combination. The `pathSecret` is generated when the app is created and can be regenerated by the app owner at any time through the dashboard.

## Request Format

```json
{
  "field1": "value1",
  "field2": "value2",
  "field3": "value3"
}
```

Field names should match the column names in your Google Sheet.

## Response Format

### Success (200 OK)

```json
{
  "success": true,
  "message": "Form submitted successfully"
}
```

### Error (4xx/5xx)

```json
{
  "error": "Error message"
}
```

Common error codes:
- `400`: Invalid request body
- `403`: Invalid appId or pathSecret
- `429`: Rate limit exceeded
- `500`: Server error or Google Sheets API error

## Rate Limiting

Each app is limited to 100 submissions per hour. When a rate limit is exceeded, the API returns a 429 status code along with headers:

```
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1627384800
```

## Regenerating the Secret

App owners can regenerate the `pathSecret` at any time through the dashboard using the FormSubmissionUrl component. This is useful if you suspect the URL has been compromised or you need to revoke access.

## Implementation Details

1. The API uses the Supabase service role to access the app's data and the sheet owner's OAuth credentials
2. OAuth tokens are automatically refreshed if expired
3. Form data is validated against the sheet's column metadata
4. Submissions are logged to the `form_submissions` table for analytics and monitoring
5. No API keys or OAuth credentials are exposed to client apps

## Security Considerations

- The `pathSecret` should be treated as a secret credential
- In production, consider implementing additional security measures like CORS restrictions
- Monitor form submissions for unusual patterns or abuse

## Usage in V0 Apps

When generating an app with V0, the prompt includes the form submission URL with the path secret. V0 will automatically use this URL to submit form data to the Google Sheet.
